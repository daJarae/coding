22F2_HW2_2018131403
================
2022-12-06

# 1

1)  

    ------------------------------------------------------------------------

``` r
n=22; x=15; grid=seq(0,1,.0001)

#prior scaled
prior=10*dbeta(grid,2,4)+0.5; prior=prior/sum(prior*.0001)
#likelihood scaled
like=dbinom(x, n, grid); like=like/sum(like*.0001)
#posterior scaled
post=like*prior; post=post/sum(post*.0001)

#prior mean, prior variance
pr_m=round(mean(grid*prior),3)
pr_v=round(mean((grid-mean(grid*prior))^2*prior),3)

#posterior mean, posterior variance
pt_m=round(mean(grid*post),3) 
pt_v=round(mean((grid-mean(grid*post))^2*post),3)

data.frame(prior=c(pr_m,pr_v),posterior=c(pt_m,pt_v),row.names=c('mean','variance'))
```

    ##          prior posterior
    ## mean     0.341     0.612
    ## variance 0.035     0.009

The prior variance is 0.035 and the posterior variance is 0.009. (Also,
the shape of posterior density seems similar to likelihood density than
that of prior density, which can be known from 1(b).) It implies the
posterior density is more credible for estimating parameter than prior
density, which is supported by the information of data (the likelihood).

2)  

    ------------------------------------------------------------------------

``` r
#plot of prior, likelihood, posterior for n=22, x=15
plot(grid,like, type="l",lty=2, col=1,xlab=expression(theta),
     ylab="density", ylim=c(0,max(like,prior,post))); lines(grid,prior,col="blue"); lines(grid,post,lwd=2,col="red"); legend("topright", c("Likelihood","Prior","Posterior"),lwd=c(1,1,2),lty=c(2,1,1),col=c(1,"blue","red"))
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

``` r
x=220; n=300
#prior remains same
prior=10*dbeta(grid,2,4)+0.5; prior=prior/sum(prior*.0001)
#likelihood updated
like=dbinom(x, n, grid); like=like/sum(like*.0001)
#posterior updated
post=like*prior; post=post/sum(post*.0001)

#plot of prior, likelihood, posterior for n=300, x=220
plot(grid,like, type="l",lty=2, col=1,xlab=expression(theta),
     ylab="density", ylim=c(0,max(like,prior,post))); lines(grid,prior,col="blue"); lines(grid,post,lwd=2,col="red"); legend("topright", c("Likelihood","Prior","Posterior"),lwd=c(1,1,2),lty=c(2,1,1),col=c(1,"blue","red"))
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

With larger n, the posterior density weighs much more on likelihood
density, with the effect of prior being slight. (The R code is also in
the attached R script file.)

3)  

    ------------------------------------------------------------------------

``` r
n=22; x=15; grid=seq(0,1,.0001)

#prior
prior=20*dbeta(grid,2,4)+1
#likelihood
like=dbinom(x, n, grid)
#posterior
post=like*prior; post=post/sum(post*.0001)

#Monte Carlo approximation
pt=function(t,x,n){(10*dbeta(t,2,4)+0.5)*dbinom(x,n,t)}
M=pt(grid[which.max(pt(grid,15,22))],15,22)
mv=(runif(length(grid),max=M))
t=grid[mv<pt(grid,15,22)] #theta

set.seed(13)
tildex=rbinom(10000,15,t)
freq=table(tildex)
x.pred=as.integer(names(freq))
predp=freq/sum(freq)
plot(x.pred,predp,type="h",ylab="Posterior Predictive PMF")
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

4)  

    ------------------------------------------------------------------------

(d)(1)

The exact function
$$20(\sqrt{\phi})^{15}(1-\sqrt{\phi})^{10}+(\sqrt{\phi})^{14}(1-\sqrt{\phi})^7$$

which is derived as

$$p_\phi(\phi) = p_θ(\sqrt{\phi}) × \frac{d\sqrt{\phi}}{d\phi}  $$

``` r
#empirical
set.seed(1)
n=10^5; grid=seq(0,1,length=10000)
theta=runif(n,max=M)
theta=grid[theta<pt(grid,15,22)]
theta_2=theta^2
#exact
exact=function(phi){20*sqrt(phi)^15*(1-sqrt(phi))^10+sqrt(phi)^14*(1-sqrt(phi))^7}
hist(theta_2,main="density of phi"); curve(exact(x)*170000000,xlab="phi",ylab="exact posterior of phi")
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-5-2.png)<!-- -->

``` r
#The constant was multiplied so that two density can be compared.
```

The histogram which represents empirical posterior density and the exact
line posterior density have similar shape.

(d)(2)

``` r
set.seed(1)
n=10^5; grid=seq(0,1,length=10000)

M1=pt(grid[which.max(pt(grid,15,22))],15,22)
theta=runif(n,max=M1)
theta=grid[theta<pt(grid,15,22)] #random samples from posterior of theta
theta=theta[!is.na(theta)]
hist(theta)
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
M2=exact(grid[which.max(exact(grid))])
phi=runif(n,max=M2)
phi=grid[phi<exact(grid)] #random samples from posterior of phi
phi=phi[!is.na(phi)]
hist(phi)
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

``` r
loss_function=function(t,a){return((t-a)^2)}

a=seq(0,1,by=0.005)

post_loss_theta = function(a){
  loss=apply(as.matrix(theta),1,loss_function,a)
  risk=mean(loss)}


pt_loss_t=apply(as.matrix(a),1,post_loss_theta)

post_loss_phi = function(a){
  loss=apply(as.matrix(phi),1,loss_function,a)
  risk=mean(loss)}

pt_loss_p=apply(as.matrix(a),1,post_loss_phi)

plot(a, pt_loss_t, type = 'l', lwd=2,col='blue', ylab ='posterior expected loss'); lines(a, pt_loss_p, type = 'l', lwd=2, col='red'); legend("topright", c("theta","phi"),lwd=c(2,2),lty=c(1,1),col=c("blue","red"))
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

``` r
e_theta=a[which.min(pt_loss_t)] #Bayes estimator of theta
e_phi=a[which.min(pt_loss_p)] #Bayes estimator of phi

data.frame(estimate=round(c(e_theta^2, e_phi),3),row.names=c("theta^2","phi"))
```

    ##         estimate
    ## theta^2    0.378
    ## phi        0.425

Given the squared error loss function from (d), the estimate of $\phi$
is larger than $\theta^2$. I think it happened from the same loss
function applied for estimating theta and theta squared.

## 2

1)  

    ------------------------------------------------------------------------

(a)(1)

As mean=0.1 and standard deviation is 0.1, the prior function is pdf of
gamma distribution with a=1 and b=10. The posterior density function
$f(\theta|x)$ is proportional to
$\prod_{i=1}^{280} \frac{\theta^{x_i}e^{-10\theta}}{x_i!}e^{-290\theta}$.
It is simplified as $\theta^{196}e^{-290\theta}$, which is proportional
to pdf of Gamma(197,290).

``` r
#Prior credible interval
pr_n=rgamma(10000,1,10)
Pr_CI=round(quantile(pr_n,prob=c(.025,.975)),4)

#Post credible interval
pt_n=rgamma(10000,197,290)
Pt_CI=round(quantile(pt_n,prob=c(.025,.975)),4)

data.frame(Pr_CI,Pt_CI)
```

    ##        Pr_CI  Pt_CI
    ## 2.5%  0.0027 0.5890
    ## 97.5% 0.3708 0.7771

(a)(2)

``` r
a=seq(0,1,by=0.005); set.seed(2)
loss_function=function(t,a){return(exp(1)^(a-t)-(a-t)-1)}

post_loss = function(a){
  theta=rgamma(10000,196,290)
  loss=apply(as.matrix(theta),1,loss_function,a)
  risk = mean(loss)}

pt_loss_theta=apply(as.matrix(a),1,post_loss)

plot(a, pt_loss_theta, type = 'l', lwd=2,col='blue', ylab ='posterior expected loss')
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

``` r
data.frame(theta=a[which.min(pt_loss_theta)],row.names=c("Bayes estimate"))
```

    ##                theta
    ## Bayes estimate 0.675

2)  

    ------------------------------------------------------------------------

(b)(1)

``` r
theta=seq(0.001,9.999,.001)

prior=1/(theta^2); prior=prior/sum(prior*.001)
like=(theta^196)*exp(1)^(-280*theta); like=like/sum(like*.001)
post=prior*like; post=post/sum(post*.001) #to make it added up to 1

plot(theta,post,type = 'l', lwd=2,col='blue', ylab ='posterior density')
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-13-1.png)<!-- -->

``` r
#the posterior mean of theta
data.frame(post_mean=round(mean(theta*post),3),row.names=c('theta'))
```

    ##       post_mean
    ## theta      0.07

(b)(2)

Since $\tilde{X}$ is discrete random variable, $P(\tilde{x}>0|\theta)$
equals to 1-$P(\tilde{x}=0|\theta)$.

``` r
1-(290/291)^197
```

    ## [1] 0.4924407

# 3

1)  

``` r
n=22; x=15; grid=seq(0.35,0.6,.0001)

x#prior scaled
```

    ## [1] 15

``` r
prior=dbeta(grid,10,10)
#likelihood scaled
like=dbinom(x, n, grid)
#posterior scaled
post=like*prior

#Scaling posterior density to be added up to 1, so that the posterior function is pdf.
post=post/(sum(post)/length(post))

#posterior mean of theta
data.frame(post_mean=round(mean(grid*post),3),row.names=c('theta'))
```

    ##       post_mean
    ## theta     0.538

2)  

``` r
theta=seq(0,10,.001)

#prior1, prior2
prior1=(1+theta)*exp(1)^(-theta)
prior2=(1+(8*theta)^2)^(-1)

#likelihood remains same
like=(theta^196)*exp(1)^(-280*theta)

#posterior1, posterior2
post1=prior1*like; post1=post1/sum(post1*.001)
post2=prior2*like; post2=post2/sum(post2*.001)

#posterior standard deviation for each prior
round(sqrt(mean((theta-mean(theta*post1))^2*post1)),3)
```

    ## [1] 0.201

``` r
round(sqrt(mean((theta-mean(theta*post2))^2*post2)),3)
```

    ## [1] 0.199

``` r
plot(theta,post1,col="red",cex=0.3); lines(theta,post2,col="blue"); legend("topright", c("Posterior1","Posterior2"),lty=c(1,1),col=c("red","blue"))
```

![](STAT404_22Fmid_2018131403_files/figure-gfm/unnamed-chunk-17-1.png)<!-- -->

The two posterior densities are almost same as they are overlapped. Both
of the posterior densities are highly affected by the likelihood part
for both cases.
